# Seq2Seq (with attention) solution for KDD CUP 2018

## KDD CUP 2018 介绍

https://biendata.com/competition/kdd_2018/

## 比赛经历
我正式参加比赛时已经四月二十几号了，之后只好边做边改。先后用PyTorch以Seq2Seq框架为基础，实现了几个模型：

## Missing data
用了一个简单粗暴的方法，对动态的数据分别产生新的一列，用0、1分别表示该数据是有效的还是缺失的。这样，数据是否缺失也作为一个特征送入模型中学习。

### Seq2Seq （no_attn branch)
在PyTorch下实现的基本Seq2Seq框架，encoder和decoder分别使用GRU，layer和hidden unit为超参数。使用之前N（N为参数，比如120,240,480,720等）小时的序列预测之后48小时的空气质量。简单起见，只使用了北京和伦敦的所有空气质量站的数据，没有使用比赛提供的其它数据。还增加了一些时间特征，比如第几个月，第几个星期，星期的第几天，一天中的第几个小时等）。比赛前半段用的都是这个模型，中间还发现了几个严重的bug，影响了比赛的成绩。

## Seq2Seq with attention (attn_pos branch)
在比赛的中期，我尝试在已有的Seq2Seq上添加attention机制。先增加了普通的attention机制，区别起见，称之为time attention，也就是时间维度上的attention。这个机制立竿见影，让成绩提高了几个点。后来，我又尝试增加另一种attention，我称之为space attention，也就是空间维度上的attention，其实就是考虑其它空气质量站的数据对本站的影响。这个增加了之后，效果并不明显。最后保留它作为超参数，用在后来的hyperopt里面。attention的一个大问题是它太慢了，在我的实现里，它和sequence的长度相关，平均要慢五六十倍。以至于后来我使用hyperopt寻找超参数时，使用了attention的模型有时还不如no attention的模型。

## 一些失败的尝试
我还考虑过怎样使用grid数据。我想到的方法是用grid数据通过插值计算出各个空气质量站的气象数据（温度、湿度等），实现了一个模型(seq2seq_grid branch)，效果很差。我很想知道其他同学是怎么利用这些数据的。

## Ensemble
这块了解不深，所以只用了单一模型的多个checkpoint做简单平均。这种实现应该不是很好，我看到我的提交中有的时基本模型好，有的时attention模型好，应该把这两种模型融合一下。

## 经验教训
1. 早点参赛，一个模型从开始到比较成熟，对我这种初学者，至少要一个月。以后要留出足够的时间。
2. 要有一个成熟的cross validation框架，这次这方面做的不好，导致后来经常过拟合。
3. 这次比赛的数据有点少，尤其对于RNN这种模型，如果有过去几年的数据，效果应该好很多。

## 一点想法
最后说一点个人的想法。个人觉得一个好的模型应该是简洁的、优美的。我不喜欢通过堆积各种各样的模型来获得所谓的好成绩，因为这样既不美，也不实用。我的思路是尽量使用统一的模型去解决各种不同的问题，尽量减少特征工程或把特征工程自动化。目前仍然前路漫漫，但吾将继续求索！



